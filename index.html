<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAMA V.2 - Sales Support System</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@400;500;600;700&family=Inter:wght@400;500;600;700&display=swap');
        
        * {
            font-family: 'Inter', 'Noto Sans Thai', sans-serif;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            overflow-x: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
        }
        
        #root {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            overflow: hidden;
        }
        
        :root {
            --primary-gradient: linear-gradient(135deg, #0ea5e9 0%, #6366f1 100%);
            --dark-gradient: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        }
        
        .animate-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .custom-scrollbar::-webkit-scrollbar {
            width: 4px;
            height: 4px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }
        
        .custom-scrollbar:hover::-webkit-scrollbar-thumb {
            background: #94a3b8;
        }
        
        .slide-in-from-bottom {
            animation: slideInFromBottom 0.5s ease-out;
        }
        
        @keyframes slideInFromBottom {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .spinner {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        input, textarea, select {
            font-size: 16px !important;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #0ea5e9 !important;
            box-shadow: 0 0 0 2px rgba(14, 165, 233, 0.2);
        }
        
        .fixed-height {
            height: 100vh;
            height: 100dvh;
        }
        
        /* Icon colors - flat colors */
        .icon-primary { color: #0ea5e9; }
        .icon-secondary { color: #6366f1; }
        .icon-success { color: #10b981; }
        .icon-warning { color: #f59e0b; }
        .icon-danger { color: #ef4444; }
        .icon-purple { color: #8b5cf6; }
        .icon-pink { color: #ec4899; }
        .icon-gray { color: #6b7280; }
        
        /* Mode badges */
        .mode-badge-ai {
            background: linear-gradient(45deg, #0ea5e9, #6366f1);
            color: white;
            font-weight: bold;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        .mode-badge-alt {
            background: linear-gradient(45deg, #6b7280, #9ca3af);
            color: white;
            font-weight: bold;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        /* Modal styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            padding: 20px;
        }
        
        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        /* Dropdown fixes */
        select option:checked {
            background: linear-gradient(135deg, #0ea5e9 0%, #6366f1 100%);
            color: white;
        }
        
        /* Improved input visibility */
        .form-input {
            background-color: #f8fafc !important;
            border: 2px solid #e2e8f0 !important;
        }
        
        .form-input:focus {
            background-color: white !important;
            border-color: #0ea5e9 !important;
        }
    </style>
</head>
<body class="bg-slate-900">
    <div id="root" class="fixed-height"></div>
    
    <script>
        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Tailwind
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'Noto Sans Thai', 'sans-serif'],
                    },
                    colors: {
                        'primary': '#0ea5e9',
                        'secondary': '#6366f1',
                    }
                }
            }
        };

        // --- Enhanced Regional Data Schema ---
        const RH_DATA = {
            "RH1": {
                name: "RH1: ‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏Ø & ‡∏õ‡∏£‡∏¥‡∏°‡∏ì‡∏ë‡∏•",
                dynamics: "‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡πÄ‡∏°‡∏∑‡∏≠‡∏á ‡πÄ‡∏£‡πà‡∏á‡∏£‡∏µ‡∏ö ‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡∏™‡∏π‡∏á ‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏£‡∏≠‡∏á‡∏ä‡∏µ‡∏û‡∏™‡∏π‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î",
                keywords: ["‡∏†‡∏≤‡∏©‡∏µ‡∏™‡∏±‡∏á‡∏Ñ‡∏°", "‡∏Ñ‡πà‡∏≤‡πÄ‡∏™‡∏µ‡∏¢‡πÄ‡∏ß‡∏•‡∏≤", "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏û‡∏£‡∏µ‡πÄ‡∏°‡∏µ‡∏¢‡∏°", "‡∏°‡∏£‡∏î‡∏Å‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏ö‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ"],
                hospitals: ["‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏≤‡∏©‡∏é‡∏£‡πå", "‡∏™‡∏°‡∏¥‡∏ï‡∏¥‡πÄ‡∏ß‡∏ä ‡∏™‡∏∏‡∏Ç‡∏∏‡∏°‡∏ß‡∏¥‡∏ó", "‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û", "‡∏û‡∏ç‡∏≤‡πÑ‡∏ó 2"],
                tone: "Professional, ‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö, ‡πÄ‡∏ô‡πâ‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÅ‡∏•‡∏∞‡∏ú‡∏•‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô",
                context: "‡πÄ‡∏ô‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏†‡∏≤‡∏©‡∏µ ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏ó‡∏µ‡πà‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß‡πÉ‡∏ô ‡∏£‡∏û. ‡∏£‡∏∞‡∏î‡∏±‡∏ö World Class",
                commonGrounds: ["‡∏£‡∏ñ‡πÑ‡∏ü‡∏ü‡πâ‡∏≤ BTS/MRT", "‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤‡∏ä‡∏±‡πâ‡∏ô‡∏ô‡∏≥", "‡∏Å‡∏≤‡∏£‡∏à‡∏£‡∏≤‡∏à‡∏£‡∏ï‡∏¥‡∏î‡∏Ç‡∏±‡∏î", "‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏£‡∏≠‡∏á‡∏ä‡∏µ‡∏û‡∏™‡∏π‡∏á"],
                metaphors: ["‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô‡∏à‡∏≤‡∏Å‡∏´‡∏∏‡πâ‡∏ô‡∏•‡∏á‡∏ó‡∏∏‡∏ô", "‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏Ñ‡∏≠‡∏ô‡πÇ‡∏î 1 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô", "‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡∏†‡∏≤‡∏©‡∏µ‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå‡∏´‡∏£‡∏π"]
            },
            "RH2": {
                name: "RH2: ‡∏†‡∏≤‡∏Ñ‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏≠‡∏≠‡∏Å (EEC)",
                dynamics: "‡πÄ‡∏Ç‡∏ï‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏Å‡∏¥‡∏à‡πÉ‡∏´‡∏°‡πà ‡∏ô‡∏¥‡∏Ñ‡∏°‡∏≠‡∏∏‡∏ï‡∏™‡∏≤‡∏´‡∏Å‡∏£‡∏£‡∏° ‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡πÅ‡∏ï‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á",
                keywords: ["‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô", "‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì‡πÑ‡∏ß", "‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏¥‡∏Å‡∏≤‡∏£‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô", "‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏£‡∏¥‡∏°"],
                hospitals: ["‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏û‡∏±‡∏ó‡∏¢‡∏≤", "‡∏™‡∏°‡∏¥‡∏ï‡∏¥‡πÄ‡∏ß‡∏ä ‡∏®‡∏£‡∏µ‡∏£‡∏≤‡∏ä‡∏≤", "‡∏û‡∏ç‡∏≤‡πÑ‡∏ó ‡∏®‡∏£‡∏µ‡∏£‡∏≤‡∏ä‡∏≤"],
                tone: "‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏à, ‡πÄ‡∏ô‡πâ‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡πà‡∏≤, ‡∏ï‡∏£‡∏á‡πÑ‡∏õ‡∏ï‡∏£‡∏á‡∏°‡∏≤",
                context: "‡πÄ‡∏ô‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏à‡∏≤‡∏Å‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°‡∏´‡∏•‡∏±‡∏á‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏á‡∏≤‡∏ô",
                commonGrounds: ["‡∏ô‡∏¥‡∏Ñ‡∏°‡∏≠‡∏∏‡∏ï‡∏™‡∏≤‡∏´‡∏Å‡∏£‡∏£‡∏°", "‡∏ó‡πà‡∏≤‡πÄ‡∏£‡∏∑‡∏≠‡πÅ‡∏´‡∏•‡∏°‡∏â‡∏ö‡∏±‡∏á", "‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà", "‡∏Å‡∏≤‡∏£‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß‡∏û‡∏±‡∏ó‡∏¢‡∏≤"],
                metaphors: ["‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏≠‡∏∏‡∏ö‡∏±‡∏ï‡∏¥‡πÄ‡∏´‡∏ï‡∏∏‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô", "‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏£‡∏ñ‡∏ö‡∏£‡∏£‡∏ó‡∏∏‡∏Å", "‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏î‡πÑ‡∏õ"]
            },
            "RH3": {
                name: "RH3: ‡∏†‡∏≤‡∏Ñ‡πÄ‡∏´‡∏ô‡∏∑‡∏≠",
                dynamics: "‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏ ‡∏ß‡∏±‡∏í‡∏ô‡∏ò‡∏£‡∏£‡∏°‡∏•‡πâ‡∏≤‡∏ô‡∏ô‡∏≤ ‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß‡πÄ‡∏ä‡∏¥‡∏á‡∏ß‡∏±‡∏í‡∏ô‡∏ò‡∏£‡∏£‡∏°",
                keywords: ["‡∏ö‡∏≤‡∏£‡∏°‡∏µ", "‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏´‡∏•‡∏≤‡∏ô", "‡∏≠‡∏¢‡∏π‡πà‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏á‡πà‡∏≤‡∏á‡∏≤‡∏°", "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡∏Ñ‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢"],
                hospitals: ["‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà ‡∏£‡∏≤‡∏°", "‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà", "‡∏®‡∏£‡∏µ‡∏û‡∏±‡∏í‡∏ô‡πå"],
                tone: "‡∏ô‡∏∏‡πà‡∏°‡∏ô‡∏ß‡∏•, ‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥, ‡πÄ‡∏ô‡πâ‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏£‡∏∞‡∏¢‡∏∞‡∏¢‡∏≤‡∏ß",
                context: "‡πÄ‡∏ô‡πâ‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏£‡∏î‡∏Å‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÅ‡∏•‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡πÉ‡∏ô‡∏ß‡∏±‡∏¢‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏£‡∏∞‡∏•‡∏π‡∏Å‡∏´‡∏•‡∏≤‡∏ô‡πÉ‡∏´‡πâ‡∏ô‡πâ‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î",
                commonGrounds: ["‡∏õ‡∏£‡∏∞‡πÄ‡∏û‡∏ì‡∏µ‡∏•‡πâ‡∏≤‡∏ô‡∏ô‡∏≤", "‡∏Å‡∏≤‡∏£‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß‡πÄ‡∏ä‡∏¥‡∏á‡∏ß‡∏±‡∏í‡∏ô‡∏ò‡∏£‡∏£‡∏°", "‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡πÄ‡∏¢‡πá‡∏ô‡∏™‡∏ö‡∏≤‡∏¢", "‡∏ä‡∏∏‡∏°‡∏ä‡∏ô‡πÄ‡∏Ç‡πâ‡∏°‡πÅ‡∏Ç‡πá‡∏á"],
                metaphors: ["‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏°‡∏£‡∏î‡∏Å‡∏à‡∏≤‡∏Å‡∏õ‡∏π‡πà‡∏¢‡πà‡∏≤‡∏ï‡∏≤‡∏¢‡∏≤‡∏¢", "‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÇ‡∏£‡∏Ñ‡∏£‡πâ‡∏≤‡∏¢‡πÉ‡∏ô‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡πÄ‡∏≠‡∏Å‡∏ä‡∏ô", "‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡πâ‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡πÅ‡∏ï‡πà‡∏á‡∏á‡∏≤‡∏ô"]
            },
            "RH4": {
                name: "RH4: ‡∏†‡∏≤‡∏Ñ‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏≠‡∏≠‡∏Å‡πÄ‡∏â‡∏µ‡∏¢‡∏á‡πÄ‡∏´‡∏ô‡∏∑‡∏≠",
                dynamics: "‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‡∏Ç‡∏¢‡∏≤‡∏¢ ‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏Å‡∏£‡∏£‡∏°‡∏Å‡πâ‡∏≤‡∏ß‡∏´‡∏ô‡πâ‡∏≤ ‡πÄ‡∏™‡∏≤‡∏´‡∏•‡∏±‡∏Å‡∏Ñ‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç",
                keywords: ["‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ï‡∏±‡∏ç‡∏ç‡∏π", "‡∏û‡∏∂‡πà‡∏á‡∏û‡∏≤‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ", "‡∏ó‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏•‡∏π‡∏Å", "‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏£‡∏∞‡πÉ‡∏Ñ‡∏£"],
                hospitals: ["‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô", "‡πÄ‡∏≠‡∏Å‡∏≠‡∏∏‡∏î‡∏£", "‡∏û‡∏£‡∏¥‡πâ‡∏ô‡∏ã‡πå ‡∏≠‡∏∏‡∏ö‡∏•‡∏£‡∏≤‡∏ä‡∏ò‡∏≤‡∏ô‡∏µ"],
                tone: "‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏±‡∏ô‡πÄ‡∏≠‡∏á, ‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏à‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏ç‡∏≤‡∏ï‡∏¥, ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏á‡πà‡∏≤‡∏¢",
                context: "‡πÄ‡∏ô‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏Å‡∏õ‡πâ‡∏≠‡∏á‡πÄ‡∏™‡∏≤‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡∏ö‡πâ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡∏ï‡πà‡∏≠‡∏Ñ‡∏ô‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏°‡∏≤‡∏Å",
                commonGrounds: ["‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏Å‡∏£‡∏£‡∏°", "‡∏ï‡∏•‡∏≤‡∏î‡∏ô‡∏±‡∏î‡∏ä‡∏∏‡∏°‡∏ä‡∏ô", "‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‡πÉ‡∏´‡∏ç‡πà", "‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏á‡πà‡∏≤‡∏¢"],
                metaphors: ["‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô", "‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏£‡∏±‡∏Å‡∏©‡∏≤ 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÉ‡∏ô‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û", "‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡πà‡∏á‡∏•‡∏π‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢"]
            },
            "RH5": {
                name: "RH5: ‡∏†‡∏≤‡∏Ñ‡πÉ‡∏ï‡πâ",
                dynamics: "‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏á/‡∏™‡∏ß‡∏ô‡∏¢‡∏≤‡∏á/‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤",
                keywords: ["‡πÉ‡∏à‡∏ô‡∏±‡∏Å‡πÄ‡∏•‡∏á", "‡∏û‡∏ß‡∏Å‡∏û‡πâ‡∏≠‡∏á", "‡∏™‡∏†‡∏≤‡∏û‡∏Ñ‡∏•‡πà‡∏≠‡∏á", "‡∏Å‡∏≤‡∏£‡∏±‡∏ô‡∏ï‡∏µ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ"],
                hospitals: ["‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏´‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà", "‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï", "‡∏™‡∏á‡∏Ç‡∏•‡∏≤‡∏ô‡∏Ñ‡∏£‡∏¥‡∏ô‡∏ó‡∏£‡πå (SMC)"],
                tone: "‡∏´‡∏ô‡∏±‡∏Å‡πÅ‡∏ô‡πà‡∏ô, ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô, ‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏à, ‡πÑ‡∏°‡πà‡πÄ‡∏¢‡∏¥‡πà‡∏ô‡πÄ‡∏¢‡πâ‡∏≠",
                context: "‡πÄ‡∏ô‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡πá‡∏≠‡∏Å‡∏Å‡∏≥‡πÑ‡∏£‡∏à‡∏≤‡∏Å‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡∏ó‡∏µ‡πà‡∏™‡∏°‡πà‡∏≥‡πÄ‡∏™‡∏°‡∏≠",
                commonGrounds: ["‡∏™‡∏ß‡∏ô‡∏¢‡∏≤‡∏á‡∏û‡∏≤‡∏£‡∏≤", "‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏á", "‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß", "‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏ä‡∏≤‡∏¢‡∏ù‡∏±‡πà‡∏á"],
                metaphors: ["‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡πÄ‡∏£‡∏∑‡∏≠‡∏õ‡∏£‡∏∞‡∏°‡∏á", "‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏ô‡πâ‡∏≥‡∏¢‡∏≤‡∏á 1 ‡∏ß‡∏±‡∏ô", "‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡∏£‡∏≠‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏û‡∏≤‡∏¢‡∏∏‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤"]
            }
        };

        const ZONES = {
            "RH1": ["‡∏™‡∏≤‡∏ó‡∏£-‡∏™‡∏µ‡∏•‡∏°", "‡∏™‡∏∏‡∏Ç‡∏∏‡∏°‡∏ß‡∏¥‡∏ó", "‡∏•‡∏≤‡∏î‡∏û‡∏£‡πâ‡∏≤‡∏ß", "‡∏ô‡∏ô‡∏ó‡∏ö‡∏∏‡∏£‡∏µ", "‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏õ‡∏£‡∏≤‡∏Å‡∏≤‡∏£"],
            "RH2": ["‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ", "‡∏®‡∏£‡∏µ‡∏£‡∏≤‡∏ä‡∏≤-‡∏û‡∏±‡∏ó‡∏¢‡∏≤", "‡∏£‡∏∞‡∏¢‡∏≠‡∏á", "‡∏â‡∏∞‡πÄ‡∏ä‡∏¥‡∏á‡πÄ‡∏ó‡∏£‡∏≤"],
            "RH3": ["‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà", "‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡∏£‡∏≤‡∏¢", "‡∏û‡∏¥‡∏©‡∏ì‡∏∏‡πÇ‡∏•‡∏Å", "‡∏ô‡∏Ñ‡∏£‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡πå"],
            "RH4": ["‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô", "‡∏ô‡∏Ñ‡∏£‡∏£‡∏≤‡∏ä‡∏™‡∏µ‡∏°‡∏≤", "‡∏≠‡∏∏‡∏ö‡∏•‡∏£‡∏≤‡∏ä‡∏ò‡∏≤‡∏ô‡∏µ", "‡∏≠‡∏∏‡∏î‡∏£‡∏ò‡∏≤‡∏ô‡∏µ"],
            "RH5": ["‡∏´‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà", "‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï", "‡∏™‡∏∏‡∏£‡∏≤‡∏©‡∏é‡∏£‡πå‡∏ò‡∏≤‡∏ô‡∏µ", "‡∏ô‡∏Ñ‡∏£‡∏®‡∏£‡∏µ‡∏ò‡∏£‡∏£‡∏°‡∏£‡∏≤‡∏ä"]
        };

        // Insurance Products Database
        const INSURANCE_PRODUCTS = {
            "‡∏•‡∏î‡∏´‡∏¢‡πà‡∏≠‡∏ô‡∏†‡∏≤‡∏©‡∏µ": [
                { name: "‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡πÅ‡∏ö‡∏ö‡∏≠‡∏≠‡∏°‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå", coverage: "‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï 1,000,000 ‡∏ö‡∏≤‡∏ó + ‡∏™‡∏∞‡∏™‡∏°‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå", premium: "25,000-50,000", features: ["‡∏•‡∏î‡∏´‡∏¢‡πà‡∏≠‡∏ô‡∏†‡∏≤‡∏©‡∏µ‡πÑ‡∏î‡πâ 100%", "‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏ö‡∏™‡∏±‡∏ç‡∏ç‡∏≤", "‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï"] },
                { name: "‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡πÅ‡∏ö‡∏ö‡∏ö‡∏≥‡∏ô‡∏≤‡∏ç", coverage: "‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï + ‡∏ö‡∏≥‡∏ô‡∏≤‡∏ç‡∏ß‡∏±‡∏¢‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì", premium: "30,000-60,000", features: ["‡∏•‡∏î‡∏´‡∏¢‡πà‡∏≠‡∏ô‡∏†‡∏≤‡∏©‡∏µ‡πÑ‡∏î‡πâ 100%", "‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏ö‡∏≥‡∏ô‡∏≤‡∏ç‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì", "‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏ï‡∏•‡∏≠‡∏î‡∏™‡∏±‡∏ç‡∏ç‡∏≤"] }
            ],
            "‡∏°‡∏£‡∏î‡∏Å‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏´‡∏•‡∏≤‡∏ô": [
                { name: "‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡πÅ‡∏ö‡∏ö‡∏ï‡∏•‡∏≠‡∏î‡∏ä‡∏µ‡∏û", coverage: "‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï 2,000,000 ‡∏ö‡∏≤‡∏ó", premium: "40,000-80,000", features: ["‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á‡∏ï‡∏•‡∏≠‡∏î‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï", "‡∏°‡∏£‡∏î‡∏Å‡πÉ‡∏´‡πâ‡∏ó‡∏≤‡∏¢‡∏≤‡∏ó", "‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏Ñ‡∏á‡∏ó‡∏µ‡πà"] },
                { name: "‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡πÅ‡∏ö‡∏ö‡∏™‡∏∞‡∏™‡∏°‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå", coverage: "‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï 1,500,000 ‡∏ö‡∏≤‡∏ó + ‡∏™‡∏∞‡∏™‡∏°‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå", premium: "30,000-50,000", features: ["‡∏°‡∏£‡∏î‡∏Å‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏°", "‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏Ñ‡∏á‡∏ó‡∏µ‡πà", "‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏∑‡∏ô‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏≤‡∏Å‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏≠‡∏¢‡∏π‡πà"] }
            ],
            "‡∏Ñ‡πà‡∏≤‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• (‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û)": [
                { name: "‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û IPD/OPD", coverage: "‡∏Ñ‡πà‡∏≤‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 500,000 ‡∏ö‡∏≤‡∏ó", premium: "15,000-30,000", features: ["‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡πÉ‡∏ô-‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏ô‡∏≠‡∏Å", "‡πÄ‡∏´‡∏°‡∏≤‡∏à‡πà‡∏≤‡∏¢‡∏ï‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á", "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ß‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡πà‡∏≠‡∏Ñ‡∏£‡∏±‡πâ‡∏á"] },
                { name: "‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡πÇ‡∏£‡∏Ñ‡∏£‡πâ‡∏≤‡∏¢‡πÅ‡∏£‡∏á", coverage: "‡πÇ‡∏£‡∏Ñ‡∏£‡πâ‡∏≤‡∏¢‡πÅ‡∏£‡∏á 1,000,000 ‡∏ö‡∏≤‡∏ó", premium: "20,000-40,000", features: ["‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á‡πÇ‡∏£‡∏Ñ‡∏£‡πâ‡∏≤‡∏¢‡πÅ‡∏£‡∏á 30 ‡πÇ‡∏£‡∏Ñ", "‡∏à‡πà‡∏≤‡∏¢‡∏Å‡πâ‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö‡πÇ‡∏£‡∏Ñ", "‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏Ñ‡∏á‡∏ó‡∏µ‡πà"] }
            ],
            "‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏°/‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì": [
                { name: "‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡πÅ‡∏ö‡∏ö‡∏™‡∏∞‡∏™‡∏°‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏£‡∏∞‡∏¢‡∏∞‡∏¢‡∏≤‡∏ß", coverage: "‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï + ‡∏™‡∏∞‡∏™‡∏°‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå", premium: "50,000-100,000", features: ["‡∏≠‡∏≠‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏¢‡∏≤‡∏ß", "‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡πâ‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏ö‡∏™‡∏±‡∏ç‡∏ç‡∏≤", "‡∏•‡∏î‡∏´‡∏¢‡πà‡∏≠‡∏ô‡∏†‡∏≤‡∏©‡∏µ‡πÑ‡∏î‡πâ"] },
                { name: "‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏ö‡∏≥‡∏ô‡∏≤‡∏ç‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì", coverage: "‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï + ‡∏ö‡∏≥‡∏ô‡∏≤‡∏ç", premium: "60,000-120,000", features: ["‡∏£‡∏±‡∏ö‡∏ö‡∏≥‡∏ô‡∏≤‡∏ç‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏≠‡∏≤‡∏¢‡∏∏ 55/60 ‡∏õ‡∏µ", "‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏≠‡∏≠‡∏°", "‡∏•‡∏î‡∏´‡∏¢‡πà‡∏≠‡∏ô‡∏†‡∏≤‡∏©‡∏µ‡πÑ‡∏î‡πâ"] }
            ]
        };

        // Icon mapping - Flat color icons
        const ICONS = {
            calculator: '<i class="fas fa-calculator icon-primary"></i>',
            message: '<i class="fas fa-comment-dots icon-secondary"></i>',
            shield: '<i class="fas fa-shield-alt icon-warning"></i>',
            gift: '<i class="fas fa-gift icon-success"></i>',
            bag: '<i class="fas fa-shopping-bag icon-purple"></i>',
            file: '<i class="fas fa-file-check icon-success"></i>',
            terminal: '<i class="fas fa-terminal icon-gray"></i>',
            sparkles: '<i class="fas fa-sparkles icon-warning"></i>',
            map: '<i class="fas fa-map-marker-alt icon-danger"></i>',
            alert: '<i class="fas fa-exclamation-circle icon-danger"></i>',
            building: '<i class="fas fa-building icon-primary"></i>',
            stethoscope: '<i class="fas fa-stethoscope icon-purple"></i>',
            lightbulb: '<i class="fas fa-lightbulb icon-warning"></i>',
            zap: '<i class="fas fa-bolt icon-warning"></i>',
            trending: '<i class="fas fa-chart-line icon-success"></i>',
            copy: '<i class="fas fa-copy icon-gray"></i>',
            rotate: '<i class="fas fa-redo icon-gray"></i>',
            thumbsUp: '<i class="fas fa-thumbs-up icon-success"></i>',
            thumbsDown: '<i class="fas fa-thumbs-down icon-danger"></i>',
            share: '<i class="fas fa-share-alt icon-primary"></i>',
            save: '<i class="fas fa-save icon-primary"></i>',
            chevronRight: '<i class="fas fa-chevron-right"></i>',
            aiBadge: '<i class="fas fa-brain icon-primary"></i>',
            altBadge: '<i class="fas fa-tools icon-gray"></i>'
        };

        // --- Alternative Mode Analysis Engine ---
        class AlternativeAnalysisEngine {
            static analyzeNeeds(formData, rhData, zone) {
                const income = parseFloat(formData.income) || 0;
                const dependents = parseInt(formData.dependents) || 0;
                const assets = parseFloat(formData.assets) || 0;
                
                // Simplified calculation for sales context
                const recommendedCoverage = income * 10; // 10 times annual income
                const gap = Math.max(0, recommendedCoverage - assets);
                
                // Risk assessment based on dependents
                let riskLevel = "‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á";
                let recommendations = [];
                
                if (dependents > 2) riskLevel = "‡∏™‡∏π‡∏á";
                if (dependents === 0) riskLevel = "‡∏ï‡πà‡∏≥";
                
                // Practical recommendations for sales
                recommendations.push(`‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ ${Math.round(recommendedCoverage / 1000000)} ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó`);
                
                if (dependents > 0) {
                    recommendations.push(`‡∏Ñ‡∏ß‡∏£‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏π‡∏Å${dependents >= 2 ? '‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏ô' : ''}`);
                }
                
                if (income > 500000) {
                    recommendations.push("‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°‡πÇ‡∏£‡∏Ñ‡∏£‡πâ‡∏≤‡∏¢‡πÅ‡∏£‡∏á");
                }
                
                const metaphor = rhData.metaphors ? rhData.metaphors[0] : "‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏î‡∏´‡∏≤‡∏¢‡πÑ‡∏õ";
                
                return {
                    gap,
                    recommendedCoverage,
                    riskLevel,
                    recommendations,
                    metaphor
                };
            }
            
            static analyzeIceBreaking(formData, rhData, zone) {
                const age = formData.age || "35-40";
                const job = formData.job || "‡∏≠‡∏≤‡∏ä‡∏µ‡∏û‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ";
                const location = formData.location || "‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏ö‡∏Å‡∏±‡∏ô";
                
                const commonGround = rhData.commonGrounds ? rhData.commonGrounds[0] : "‡∏™‡∏†‡∏≤‡∏û‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°‡∏£‡∏≠‡∏ö‡∏ï‡∏±‡∏ß";
                
                // Practical conversation starters for sales
                const starters = [
                    `"‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö/‡∏Ñ‡∏∞ ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏°‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ô${age}‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ñ‡∏∏‡∏ì"`,
                    `"‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö${job}‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏∏‡∏ì ‡∏°‡∏µ‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏´‡∏•‡∏≤‡∏¢‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏ï‡∏≠‡∏ö‡πÇ‡∏à‡∏ó‡∏¢‡πå"`,
                    `"‡πÄ‡∏´‡πá‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏°‡∏≤${location} ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ô‡∏∂‡∏Å‡∏ñ‡∏∂‡∏á‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç..."`
                ];
                
                const hooks = [
                    `"‡πÄ‡∏Ñ‡∏¢‡∏Ñ‡∏¥‡∏î‡πÑ‡∏´‡∏°‡∏ß‡πà‡∏≤ ‡∏ñ‡πâ‡∏≤‡∏ß‡∏±‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏¢‡∏∏‡∏î‡∏ó‡∏≥‡∏á‡∏≤‡∏ô ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‡∏à‡∏∞‡∏°‡∏µ‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏ä‡πâ‡∏Å‡∏µ‡πà‡πÄ‡∏î‡∏∑‡∏≠‡∏ô?"`,
                    `"‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Å‡∏≤‡∏£‡∏±‡∏ô‡∏ï‡∏µ‡∏ß‡πà‡∏≤‡∏û‡∏£‡∏∏‡πà‡∏á‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏¢‡∏±‡∏á‡∏î‡∏µ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°"`,
                    `"‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏°‡πà‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô"`
                ];
                
                return {
                    starters,
                    hooks,
                    tone: rhData.tone || "‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏∑‡∏≠‡∏≠‡∏≤‡∏ä‡∏µ‡∏û",
                    commonGround
                };
            }
            
            static handleObjection(formData, rhData, zone) {
                const type = formData.type || "‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏≠";
                
                // Practical responses for sales
                const responses = {
                    "‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏≠": [
                        "‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö/‡∏Ñ‡∏∞ ‡∏ß‡πà‡∏≤‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏™‡∏π‡∏á",
                        "‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡πÅ‡∏ú‡∏ô‡πÄ‡∏•‡πá‡∏Å‡πÜ ‡∏Å‡πà‡∏≠‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡πÜ ‡∏û‡∏±‡∏í‡∏ô‡∏≤",
                        "‡πÄ‡∏£‡∏≤‡∏°‡∏µ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏à‡∏≤‡∏Å‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏ô‡πâ‡∏≠‡∏¢‡πÑ‡∏î‡πâ"
                    ],
                    "‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡πÄ‡∏¢‡∏≠‡∏∞‡πÅ‡∏•‡πâ‡∏ß": [
                        "‡∏î‡∏µ‡∏°‡∏≤‡∏Å‡∏Ñ‡∏£‡∏±‡∏ö/‡∏Ñ‡∏∞ ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô",
                        "‡∏•‡∏≠‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô‡∏ß‡πà‡∏≤‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏´‡∏•‡∏±‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á",
                        "‡∏ö‡∏≤‡∏á‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏£‡∏≤‡∏≠‡∏≤‡∏à‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡πÄ‡∏¢‡∏≠‡∏∞‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏à‡∏∏‡∏î"
                    ],
                    "‡∏Ç‡∏≠‡∏ñ‡∏≤‡∏°‡πÅ‡∏ü‡∏ô/‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‡∏Å‡πà‡∏≠‡∏ô": [
                        "‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß",
                        "‡∏ú‡∏°/‡∏î‡∏¥‡∏â‡∏±‡∏ô‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏£‡∏∏‡∏õ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡∏ô‡∏≥‡πÑ‡∏õ‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡πÑ‡∏î‡πâ",
                        "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡∏Ñ‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‡∏Ñ‡∏∑‡∏≠‡∏™‡∏¥‡πà‡∏á‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç"
                    ],
                    "‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡πÇ‡∏Å‡∏á/‡πÄ‡∏ö‡∏¥‡∏Å‡∏¢‡∏≤‡∏Å": [
                        "‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏±‡∏á‡∏ß‡∏•‡∏ô‡∏µ‡πâ‡∏î‡∏µ ‡∏°‡∏µ‡∏Ç‡πà‡∏≤‡∏ß‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏ö‡πà‡∏≠‡∏¢",
                        "‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡πÄ‡∏£‡∏≤‡∏°‡∏µ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏Ñ‡∏•‡∏°‡∏™‡∏π‡∏á‡πÅ‡∏•‡∏∞‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß",
                        "‡∏ú‡∏°/‡∏î‡∏¥‡∏â‡∏±‡∏ô‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏°‡∏à‡∏£‡∏¥‡∏á‡πÑ‡∏î‡πâ"
                    ],
                    "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏£‡∏µ‡∏ö/‡∏¢‡∏±‡∏á‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á": [
                        "‡∏î‡∏µ‡∏°‡∏≤‡∏Å‡∏Ñ‡∏£‡∏±‡∏ö/‡∏Ñ‡∏∞ ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á",
                        "‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏î‡∏µ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤",
                        "‡∏≠‡∏∏‡∏ö‡∏±‡∏ï‡∏¥‡πÄ‡∏´‡∏ï‡∏∏‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ö‡∏≠‡∏Å‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤"
                    ]
                };
                
                return {
                    practicalResponses: responses[type] || responses["‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏≠"],
                    nextStep: "‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô",
                    keyMessage: "‡πÄ‡∏ô‡πâ‡∏ô‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏ö‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ"
                };
            }
            
            static simplifyPlan(formData, rhData, zone) {
                const planName = formData.plan_name || "‡πÅ‡∏ú‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô";
                const benefits = formData.benefits || "";
                
                // Extract key benefits for sales presentation
                const benefitList = benefits.split('\n').filter(b => b.trim()).slice(0, 3);
                const keyPoints = benefitList.length > 0 ? benefitList : [
                    "‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡πÅ‡∏•‡∏∞‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏Ñ‡∏£‡∏ö‡∏ß‡∏á‡∏à‡∏£",
                    "‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏Ñ‡∏á‡∏ó‡∏µ‡πà‡∏ï‡∏•‡∏≠‡∏î‡∏™‡∏±‡∏ç‡∏ç‡∏≤",
                    "‡∏°‡∏µ‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏ö‡∏™‡∏±‡∏ç‡∏ç‡∏≤"
                ];
                
                // Create simple explanations for sales
                const explanations = [
                    `"${planName} ‡∏ä‡πà‡∏ß‡∏¢‡∏õ‡∏Å‡∏õ‡πâ‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏•‡∏∞‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‡∏à‡∏≤‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏°‡πà‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô"`,
                    `"${keyPoints[0].substring(0, 60)}..."`,
                    `"‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡πÑ‡∏î‡πâ‡∏î‡πâ‡∏ß‡∏¢${planName}"`
                ];
                
                return {
                    keyPoints,
                    explanations,
                    salesTips: [
                        "‡πÄ‡∏ô‡πâ‡∏ô‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡∏ó‡∏µ‡πà‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏´‡πá‡∏ô‡∏†‡∏≤‡∏û‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô",
                        "‡πÉ‡∏ä‡πâ‡∏†‡∏≤‡∏©‡∏≤‡∏á‡πà‡∏≤‡∏¢‡πÜ ‡πÑ‡∏°‡πà‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô",
                        "‡∏¢‡∏Å‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏£‡∏ì‡∏µ‡πÉ‡∏Å‡∏•‡πâ‡∏ï‡∏±‡∏ß"
                    ]
                };
            }
            
            static matchProduct(formData, rhData, zone) {
                const goal = formData.goal || "‡∏•‡∏î‡∏´‡∏¢‡πà‡∏≠‡∏ô‡∏†‡∏≤‡∏©‡∏µ";
                const budget = parseFloat(formData.budget) || 30000;
                
                const products = INSURANCE_PRODUCTS[goal] || INSURANCE_PRODUCTS["‡∏•‡∏î‡∏´‡∏¢‡πà‡∏≠‡∏ô‡∏†‡∏≤‡∏©‡∏µ"];
                
                // Find product within budget
                let suitableProduct = products[0];
                
                products.forEach(product => {
                    const priceRange = product.premium.split('-').map(p => parseInt(p.replace(/[^0-9]/g, '')));
                    const minPrice = priceRange[0];
                    if (budget >= minPrice * 0.8) {
                        suitableProduct = product;
                    }
                });
                
                return {
                    recommendedProduct: suitableProduct,
                    budgetComparison: budget >= parseInt(suitableProduct.premium.split('-')[0].replace(/[^0-9]/g, '')) ? "‡∏û‡∏≠‡∏î‡∏µ‡∏Å‡∏±‡∏ö‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì" : "‡∏≠‡∏≤‡∏à‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ú‡∏ô‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢",
                    keyFeatures: suitableProduct.features.slice(0, 3),
                    salesApproach: "‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠‡∏ó‡∏µ‡∏•‡∏∞‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå ‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏Å‡πà‡∏≠‡∏ô"
                };
            }
            
            static generateClosing(formData, rhData, zone) {
                const interest = formData.interest_point || "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û";
                
                // Practical closing techniques for sales
                const closes = [
                    `"‡∏Ñ‡∏∏‡∏ì‡∏™‡∏∞‡∏î‡∏ß‡∏Å‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏ú‡∏ô‡∏ß‡∏±‡∏ô‡πÑ‡∏´‡∏ô‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö/‡∏Ñ‡∏∞"`,
                    `"‡∏≠‡∏¢‡∏≤‡∏Å‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å${interest}‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å‡∏Å‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏°"`,
                    `"‡πÄ‡∏£‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡∏Å‡∏±‡∏ô‡πÄ‡∏•‡∏¢‡∏î‡∏µ‡πÑ‡∏´‡∏°"`
                ];
                
                return {
                    closes,
                    confidenceBuilders: [
                        "‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ú‡∏ô‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏û‡∏∂‡∏á‡∏û‡∏≠‡πÉ‡∏à",
                        "‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏°‡∏µ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏´‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏Ñ‡∏£‡∏ö‡∏ß‡∏á‡∏à‡∏£",
                        "‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô ‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô"
                    ],
                    nextSteps: "‡∏Å‡∏£‡∏≠‡∏Å‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡πÅ‡∏•‡∏∞‡∏ô‡∏±‡∏î‡∏™‡πà‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£"
                };
            }
            
            static designPrompt(formData, rhData, zone) {
                const objective = formData.objective || "‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏ó‡∏™‡∏ô‡∏ó‡∏ô‡∏≤";
                const target = formData.target || "‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤";
                
                // Practical template for sales
                const templates = {
                    "‡∏ö‡∏ó‡∏™‡∏ô‡∏ó‡∏ô‡∏≤": `‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠: ‡∏Å‡∏≤‡∏£‡∏û‡∏π‡∏î‡∏Ñ‡∏∏‡∏¢‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô
‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: ${target}
‡∏à‡∏∏‡∏î‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå: ${objective}
‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà: ${zone}
‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á: 1. ‡πÄ‡∏Å‡∏£‡∏¥‡πà‡∏ô‡∏ô‡∏≥ 2. ‡∏™‡∏≥‡∏£‡∏ß‡∏à‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ 3. ‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠ 4. ‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° 5. ‡∏™‡∏£‡∏∏‡∏õ`,
                    "‡πÇ‡∏û‡∏™‡∏ï‡πå": `‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠: ‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô
‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: ${target}
‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏Å: ‡πÄ‡∏ô‡πâ‡∏ô‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏ö‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ
Call-to-Action: ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°`,
                    "‡πÄ‡∏™‡∏ô‡∏≠‡∏Ç‡∏≤‡∏¢": `‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠: ‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠‡∏Ç‡∏≤‡∏¢
‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: ${target}
‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á: ‡∏õ‡∏±‡∏ç‡∏´‡∏≤-‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç-‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå
‡πÄ‡∏ß‡∏•‡∏≤: 10-15 ‡∏ô‡∏≤‡∏ó‡∏µ`
                };
                
                return {
                    template: templates["‡∏ö‡∏ó‡∏™‡∏ô‡∏ó‡∏ô‡∏≤"],
                    tips: [
                        "‡πÉ‡∏ä‡πâ‡∏†‡∏≤‡∏©‡∏≤‡∏á‡πà‡∏≤‡∏¢‡πÜ ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÄ‡∏£‡πá‡∏ß",
                        "‡πÄ‡∏ô‡πâ‡∏ô‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡πÄ‡∏â‡∏û‡∏≤‡∏∞",
                        "‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏û‡∏ö‡∏ö‡πà‡∏≠‡∏¢"
                    ]
                };
            }
        }

        // --- Modal Component ---
        class Modal {
            static show(message, onConfirm, onCancel) {
                const modalHtml = `
                    <div class="modal-overlay animate-in">
                        <div class="modal-content">
                            <div class="mb-6">
                                <h3 class="text-lg font-bold text-slate-800 mb-3">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ó‡∏£‡∏≤‡∏ö</h3>
                                <p class="text-slate-600">${message}</p>
                            </div>
                            <div class="flex gap-3">
                                <button id="modal-cancel" class="flex-1 py-3 border border-slate-300 rounded-xl text-slate-700 font-bold hover:bg-slate-50 transition-colors">
                                    Cancel
                                </button>
                                <button id="modal-confirm" class="flex-1 py-3 bg-gradient-to-r from-sky-600 to-indigo-600 text-white font-bold rounded-xl hover:from-sky-700 hover:to-indigo-700 transition-all">
                                    Ok! Let's go
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                const modalEl = document.createElement('div');
                modalEl.innerHTML = modalHtml;
                document.body.appendChild(modalEl);
                
                document.getElementById('modal-confirm').onclick = () => {
                    modalEl.remove();
                    if (onConfirm) onConfirm();
                };
                
                document.getElementById('modal-cancel').onclick = () => {
                    modalEl.remove();
                    if (onCancel) onCancel();
                };
                
                // Close on overlay click
                modalEl.querySelector('.modal-overlay').onclick = (e) => {
                    if (e.target === modalEl.querySelector('.modal-overlay')) {
                        modalEl.remove();
                        if (onCancel) onCancel();
                    }
                };
            }
        }

        // --- Main Application ---
        class MAMAV2 {
            constructor() {
                this.state = {
                    apiKey: "",
                    isSetup: false,
                    userProfile: { rh: "", zone: "" }, // Removed agentName
                    activeTab: "needs_analysis",
                    loading: false,
                    aiResponse: "",
                    error: "",
                    feedback: null,
                    useAIMode: false,
                    forms: {
                        needs_analysis: { income: "", dependents: "", assets: "", years: "" },
                        ice_breaking: { age: "", job: "", location: "", observation: "" },
                        objection: { type: "‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏≠", direct_quote: "" },
                        simplifier: { plan_name: "", benefits: "", premium: "" },
                        matchmaker: { goal: "‡∏•‡∏î‡∏´‡∏¢‡πà‡∏≠‡∏ô‡∏†‡∏≤‡∏©‡∏µ", budget: "" },
                        closing: { interest_point: "", last_concern: "" },
                        prompt_designer: { objective: "", target: "", tone: "Professional", details: "" }
                    }
                };
                
                this.inputElements = {};
                this.init();
            }
            
            setState(newState) {
                // Merge state carefully
                const mergedState = { ...this.state };
                
                for (let key in newState) {
                    if (typeof mergedState[key] === 'object' && mergedState[key] !== null && !Array.isArray(mergedState[key])) {
                        mergedState[key] = { ...mergedState[key], ...newState[key] };
                    } else {
                        mergedState[key] = newState[key];
                    }
                }
                
                this.state = mergedState;
                this.render();
            }
            
            // Fixed: Handle select changes without resetting other fields
            handleSelectChange(section, field, value) {
                this.setState({
                    [section]: { ...this.state[section], [field]: value }
                });
            }
            
            handleInputChange(tab, field, value) {
                const newForms = { ...this.state.forms };
                newForms[tab] = { ...newForms[tab], [field]: value };
                this.setState({ forms: newForms });
                
                const inputId = `${tab}-${field}`;
                if (this.inputElements[inputId]) {
                    this.inputElements[inputId].value = value;
                }
            }
            
            calculateBasicCoverage() {
                const f = this.state.forms.needs_analysis;
                const income = parseFloat(f.income) || 0;
                const dependents = parseInt(f.dependents) || 0;
                const assets = parseFloat(f.assets) || 0;
                
                const recommended = income * 10;
                const gap = Math.max(0, recommended - assets);
                
                return { recommended, gap };
            }
            
            updateCoverageDisplay() {
                const { gap } = this.calculateBasicCoverage();
                const gapElement = document.getElementById('coverage-gap');
                if (gapElement) {
                    gapElement.textContent = `${gap.toLocaleString()} ‡∏ö‡∏≤‡∏ó`;
                }
            }
            
            // Alternative Mode Analysis
            generateAlternativeResponse() {
                const tab = this.state.activeTab;
                const formData = this.state.forms[tab];
                const rhData = RH_DATA[this.state.userProfile.rh] || {};
                const zone = this.state.userProfile.zone;
                
                let result;
                
                switch(tab) {
                    case "needs_analysis":
                        result = AlternativeAnalysisEngine.analyzeNeeds(formData, rhData, zone);
                        return `### üìä ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
                        
**‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà ${zone}:**
- ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ${result.recommendedCoverage.toLocaleString()} ‡∏ö‡∏≤‡∏ó
- ‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á: ${result.gap.toLocaleString()} ‡∏ö‡∏≤‡∏ó
- ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á: ${result.riskLevel}

**‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢:**
${result.recommendations.map((rec, i) => `${i+1}. ${rec}`).join('\n')}

**‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö:**
${result.metaphors}

**‡∏õ‡∏£‡∏∞‡πÄ‡∏î‡πá‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠:**
1. ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô
2. ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ
3. ‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï`;

                    case "ice_breaking":
                        result = AlternativeAnalysisEngine.analyzeIceBreaking(formData, rhData, zone);
                        return `### üí¨ ‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ö‡∏ó‡∏™‡∏ô‡∏ó‡∏ô‡∏≤
                        
**‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå:** ‡∏û‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏≠‡∏≤‡∏¢‡∏∏ ${formData.age || "35-40"} ‡∏≠‡∏≤‡∏ä‡∏µ‡∏û ${formData.job || "‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ"} ‡∏ó‡∏µ‡πà ${formData.location || "‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏ö‡∏Å‡∏±‡∏ô"}

**‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ö‡∏ó‡∏™‡∏ô‡∏ó‡∏ô‡∏≤:**
${result.starters.map((s, i) => `${i+1}. ${s}`).join('\n\n')}

**Hook ‡∏ó‡∏µ‡πà‡∏î‡∏∂‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ô‡πÉ‡∏à:**
${result.hooks.map((h, i) => `${i+1}. ${h}`).join('\n\n')}

**‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà ${zone}:**
- ‡πÉ‡∏ä‡πâ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á: ${result.commonGround}
- ‡∏ô‡πâ‡∏≥‡πÄ‡∏™‡∏µ‡∏¢‡∏á: ${result.tone}
- ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à`;

                    case "objection":
                        result = AlternativeAnalysisEngine.handleObjection(formData, rhData, zone);
                        return `### üõ°Ô∏è ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡πÇ‡∏ï‡πâ‡πÅ‡∏¢‡πâ‡∏á
                        
**‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡πâ‡∏≠‡πÇ‡∏ï‡πâ‡πÅ‡∏¢‡πâ‡∏á:** ${formData.type}
**‡∏Ñ‡∏≥‡∏û‡∏π‡∏î‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤:** "${formData.direct_quote || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}"

**‡∏ß‡∏¥‡∏ò‡∏µ‡∏ï‡∏≠‡∏ö‡πÇ‡∏ï‡πâ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏ú‡∏•:**
${result.practicalResponses.map((r, i) => `${i+1}. ${r}`).join('\n\n')}

**‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏õ:**
${result.nextStep}

**‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:**
${result.keyMessage}`;

                    case "simplifier":
                        result = AlternativeAnalysisEngine.simplifyPlan(formData, rhData, zone);
                        return `### üìã ‡∏™‡∏£‡∏∏‡∏õ‡πÅ‡∏ú‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô
                        
**‡πÅ‡∏ú‡∏ô:** ${formData.plan_name || "‡πÅ‡∏ú‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô"}
**‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô:** ${parseFloat(formData.premium || 0).toLocaleString()} ‡∏ö‡∏≤‡∏ó/‡∏õ‡∏µ

**‡∏à‡∏∏‡∏î‡πÄ‡∏î‡πà‡∏ô‡∏´‡∏•‡∏±‡∏Å:**
${result.keyPoints.map((p, i) => `${i+1}. ${p}`).join('\n')}

**‡∏ß‡∏¥‡∏ò‡∏µ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à:**
${result.explanations.map((e, i) => `${i+1}. ${e}`).join('\n\n')}

**‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠:**
${result.salesTips.map((t, i) => `${i+1}. ${t}`).join('\n')}`;

                    case "matchmaker":
                        result = AlternativeAnalysisEngine.matchProduct(formData, rhData, zone);
                        return `### üéØ ‡πÅ‡∏ú‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥
                        
**‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤:** ${formData.goal}
**‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì:** ${parseFloat(formData.budget || 0).toLocaleString()} ‡∏ö‡∏≤‡∏ó/‡∏õ‡∏µ

**‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:** ${result.recommendedProduct.name}
**‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á:** ${result.recommendedProduct.coverage}
**‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô:** ${result.recommendedProduct.premium} ‡∏ö‡∏≤‡∏ó/‡∏õ‡∏µ
**‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏Å‡∏±‡∏ö‡∏á‡∏ö:** ${result.budgetComparison}

**‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡πÄ‡∏î‡πà‡∏ô:**
${result.keyFeatures.map((f, i) => `${i+1}. ${f}`).join('\n')}

**‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢:**
${result.salesApproach}

**‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡πÄ‡∏ô‡πâ‡∏ô:**
1. ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤
2. ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡πà‡∏≤‡∏Ç‡∏≠‡∏á‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô
3. ‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏´‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢`;

                    case "closing":
                        result = AlternativeAnalysisEngine.generateClosing(formData, rhData, zone);
                        return `### ‚úÖ ‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢
                        
**‡∏à‡∏∏‡∏î‡∏™‡∏ô‡πÉ‡∏à‡∏Ç‡∏≠‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤:** ${formData.interest_point}
**‡∏Ç‡πâ‡∏≠‡∏Å‡∏±‡∏á‡∏ß‡∏•:** ${formData.last_concern || "‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏"}

**‡∏ß‡∏¥‡∏ò‡∏µ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢:**
${result.closes.map((c, i) => `${i+1}. ${c}`).join('\n\n')}

**‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à:**
${result.confidenceBuilders.map((b, i) => `${i+1}. ${b}`).join('\n')}

**‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ:**
${result.nextSteps}

**‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ú‡∏•:**
1. ‡∏™‡πà‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏™‡∏£‡∏∏‡∏õ‡∏î‡πà‡∏ß‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏ö‡∏Å‡∏±‡∏ô
2. ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 3 ‡∏ß‡∏±‡∏ô
3. ‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏´‡∏≤‡∏Å‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô`;

                    case "prompt_designer":
                        result = AlternativeAnalysisEngine.designPrompt(formData, rhData, zone);
                        return `### üìù ‡πÄ‡∏ó‡∏°‡πÄ‡∏û‡∏•‡∏ï‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£
                        
**‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå:** ${formData.objective}
**‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢:** ${formData.target}

**‡πÄ‡∏ó‡∏°‡πÄ‡∏û‡∏•‡∏ï‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:**
${result.template}

**‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:**
${result.tips.map((t, i) => `${i+1}. ${t}`).join('\n')}

**‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà ${zone}:**
1. ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ó‡∏µ‡πà‡∏Ñ‡∏ô‡πÉ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏á‡πà‡∏≤‡∏¢
2. ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏´‡∏£‡∏∑‡∏≠‡∏ß‡∏±‡∏í‡∏ô‡∏ò‡∏£‡∏£‡∏°‡∏ó‡πâ‡∏≠‡∏á‡∏ñ‡∏¥‡πà‡∏ô
3. ‡∏¢‡∏Å‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà`;

                    default:
                        return "### ‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå\n\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå";
                }
            }
            
            async handleGenerate() {
                if (this.state.useAIMode && !this.state.apiKey) {
                    this.setState({ 
                        error: "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏ API Key ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•",
                        loading: false 
                    });
                    return;
                }
                
                this.setState({ loading: true, aiResponse: "", error: "" });
                
                // Simulate processing time
                setTimeout(() => {
                    try {
                        const response = this.generateAlternativeResponse();
                        this.setState({ 
                            aiResponse: response,
                            loading: false
                        });
                    } catch (error) {
                        console.error("Analysis error:", error);
                        this.setState({ 
                            error: "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå: " + error.message,
                            loading: false 
                        });
                    }
                }, 800);
            }
            
            renderInputSection() {
                const tab = this.state.activeTab;
                const f = this.state.forms[tab];
                
                const createInput = (tabName, field, value, placeholder, type = "text", extraClass = "") => {
                    const id = `${tabName}-${field}`;
                    return `
                        <input 
                            id="${id}"
                            type="${type}" 
                            class="form-input w-full p-3 rounded-lg text-base ${extraClass}"
                            value="${value}"
                            oninput="app.handleInputChange('${tabName}', '${field}', this.value)"
                            placeholder="${placeholder}"
                            autocomplete="off"
                        >
                    `;
                };
                
                const createTextarea = (tabName, field, value, placeholder, rows = 4) => {
                    const id = `${tabName}-${field}`;
                    return `
                        <textarea 
                            id="${id}"
                            class="form-input w-full p-3 rounded-lg text-base resize-none"
                            rows="${rows}"
                            oninput="app.handleInputChange('${tabName}', '${field}', this.value)"
                            placeholder="${placeholder}"
                            autocomplete="off"
                        >${value}</textarea>
                    `;
                };
                
                const createSelect = (tabName, field, value, options, placeholder = "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å") => {
                    const id = `${tabName}-${field}`;
                    let optionsHtml = `<option value="" disabled ${!value ? 'selected' : ''}>${placeholder}</option>`;
                    
                    if (Array.isArray(options)) {
                        options.forEach(option => {
                            const isSelected = option === value ? 'selected' : '';
                            optionsHtml += `<option value="${option}" ${isSelected}>${option}</option>`;
                        });
                    } else if (typeof options === 'object') {
                        Object.entries(options).forEach(([key, label]) => {
                            const isSelected = key === value ? 'selected' : '';
                            optionsHtml += `<option value="${key}" ${isSelected}>${label}</option>`;
                        });
                    }
                    
                    return `
                        <select 
                            id="${id}"
                            class="form-input w-full p-3 rounded-lg text-base"
                            onchange="app.handleInputChange('${tabName}', '${field}', this.value)"
                        >
                            ${optionsHtml}
                        </select>
                    `;
                };
                
                const InputWrap = (label, children, optional = false) => `
                    <div class="mb-4">
                        <label class="block text-[11px] font-bold text-slate-500 uppercase tracking-widest mb-2 ml-1">
                            ${label} ${optional ? '<span class="text-slate-400 font-normal">(‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</span>' : ''}
                        </label>
                        ${children}
                    </div>
                `;
                
                switch (tab) {
                    case "needs_analysis":
                        const { gap } = this.calculateBasicCoverage();
                        return `
                            <div class="space-y-4 animate-in">
                                ${InputWrap("‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ï‡πà‡∏≠‡∏õ‡∏µ (‡∏ö‡∏≤‡∏ó)", 
                                    createInput('needs_analysis', 'income', f.income, "‡πÄ‡∏ä‡πà‡∏ô 500,000", "number")
                                )}
                                ${InputWrap("‡∏Ñ‡∏ô‡πÉ‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏∞", 
                                    createInput('needs_analysis', 'dependents', f.dependents, "‡πÄ‡∏ä‡πà‡∏ô 2", "number")
                                )}
                                ${InputWrap("‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ (‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏°/‡∏ó‡∏∏‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡πÄ‡∏î‡∏¥‡∏°)", 
                                    createInput('needs_analysis', 'assets', f.assets, "‡πÄ‡∏ä‡πà‡∏ô 100,000", "number"),
                                    true
                                )}
                                ${InputWrap("‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÅ‡∏• (‡∏õ‡∏µ)", 
                                    createInput('needs_analysis', 'years', f.years, "‡πÄ‡∏ä‡πà‡∏ô 10", "number"),
                                    true
                                )}
                                <div class="bg-gradient-to-r from-slate-800 to-slate-900 rounded-xl p-4 text-white shadow-lg">
                                    <div class="flex justify-between items-center text-[11px] opacity-80 mb-1">
                                        <span>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</span>
                                        ${ICONS.alert}
                                    </div>
                                    <div id="coverage-gap" class="text-xl font-bold">${gap.toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>
                                    <div class="text-[10px] opacity-60 mt-1">‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏≠‡∏Å</div>
                                </div>
                            </div>
                        `;
                    
                    case "ice_breaking":
                        return `
                            <div class="space-y-4 animate-in">
                                ${InputWrap("‡∏ä‡πà‡∏ß‡∏á‡∏≠‡∏≤‡∏¢‡∏∏‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤", 
                                    createInput('ice_breaking', 'age', f.age, "‡πÄ‡∏ä‡πà‡∏ô 35-40 ‡∏õ‡∏µ")
                                )}
                                ${InputWrap("‡∏≠‡∏≤‡∏ä‡∏µ‡∏û", 
                                    createInput('ice_breaking', 'job', f.job, "‡πÄ‡∏ä‡πà‡∏ô ‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£, ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó")
                                )}
                                ${InputWrap("‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏û‡∏ö‡∏Å‡∏±‡∏ô", 
                                    createInput('ice_breaking', 'location', f.location, "‡πÄ‡∏ä‡πà‡∏ô ‡∏£‡πâ‡∏≤‡∏ô‡∏Å‡∏≤‡πÅ‡∏ü, ‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô")
                                )}
                                ${InputWrap("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏Å‡∏≤‡∏£‡∏ì‡πå", 
                                    createTextarea('ice_breaking', 'observation', f.observation, "‡πÄ‡∏ä‡πà‡∏ô ‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏±‡∏ß‡∏™‡∏∏‡∏†‡∏≤‡∏û, ‡∏û‡∏π‡∏î‡∏ñ‡∏∂‡∏á‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‡∏ö‡πà‡∏≠‡∏¢, ‡∏î‡∏π‡∏£‡∏µ‡∏ö‡πÄ‡∏£‡πà‡∏á", 3),
                                    true
                                )}
                            </div>
                        `;
                    
                    case "objection":
                        const objectionOptions = {
                            "‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏≠": "‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏≠",
                            "‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡πÄ‡∏¢‡∏≠‡∏∞‡πÅ‡∏•‡πâ‡∏ß": "‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡πÄ‡∏¢‡∏≠‡∏∞‡πÅ‡∏•‡πâ‡∏ß",
                            "‡∏Ç‡∏≠‡∏ñ‡∏≤‡∏°‡πÅ‡∏ü‡∏ô/‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‡∏Å‡πà‡∏≠‡∏ô": "‡∏Ç‡∏≠‡∏ñ‡∏≤‡∏°‡πÅ‡∏ü‡∏ô/‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‡∏Å‡πà‡∏≠‡∏ô",
                            "‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡πÇ‡∏Å‡∏á/‡πÄ‡∏ö‡∏¥‡∏Å‡∏¢‡∏≤‡∏Å": "‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡πÇ‡∏Å‡∏á/‡πÄ‡∏ö‡∏¥‡∏Å‡∏¢‡∏≤‡∏Å",
                            "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏£‡∏µ‡∏ö/‡∏¢‡∏±‡∏á‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á": "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏£‡∏µ‡∏ö/‡∏¢‡∏±‡∏á‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á"
                        };
                        
                        return `
                            <div class="space-y-4">
                                ${InputWrap("‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡πâ‡∏≠‡πÇ‡∏ï‡πâ‡πÅ‡∏¢‡πâ‡∏á", 
                                    createSelect('objection', 'type', f.type, objectionOptions, "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó")
                                )}
                                ${InputWrap("‡∏Ñ‡∏≥‡∏û‡∏π‡∏î‡∏Ç‡∏≠‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤", 
                                    createTextarea('objection', 'direct_quote', f.direct_quote, "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏≥‡∏û‡∏π‡∏î‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ï‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á", 4),
                                    true
                                )}
                            </div>
                        `;
                    
                    case "simplifier":
                        return `
                            <div class="space-y-4">
                                ${InputWrap("‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏ú‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô", 
                                    createInput('simplifier', 'plan_name', f.plan_name, "‡πÄ‡∏ä‡πà‡∏ô ‡πÅ‡∏ú‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏û‡∏£‡∏µ‡πÄ‡∏°‡∏µ‡∏¢‡∏°")
                                )}
                                ${InputWrap("‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏ï‡πà‡∏≠‡∏õ‡∏µ (‡∏ö‡∏≤‡∏ó)", 
                                    createInput('simplifier', 'premium', f.premium, "‡πÄ‡∏ä‡πà‡∏ô 25,000", "number"),
                                    true
                                )}
                                ${InputWrap("‡∏ú‡∏•‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡∏´‡∏•‡∏±‡∏Å", 
                                    createTextarea('simplifier', 'benefits', f.benefits, "‡∏£‡∏∞‡∏ö‡∏∏ 2-3 ‡∏ú‡∏•‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç\n‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:\n‚Ä¢ ‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡πÉ‡∏ô\n‚Ä¢ ‡∏Ñ‡πà‡∏≤‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÇ‡∏£‡∏Ñ‡∏£‡πâ‡∏≤‡∏¢‡πÅ‡∏£‡∏á", 4)
                                )}
                            </div>
                        `;
                    
                    case "matchmaker":
                        const goalOptions = {
                            "‡∏•‡∏î‡∏´‡∏¢‡πà‡∏≠‡∏ô‡∏†‡∏≤‡∏©‡∏µ": "‡∏•‡∏î‡∏´‡∏¢‡πà‡∏≠‡∏ô‡∏†‡∏≤‡∏©‡∏µ",
                            "‡∏°‡∏£‡∏î‡∏Å‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏´‡∏•‡∏≤‡∏ô": "‡∏°‡∏£‡∏î‡∏Å‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏´‡∏•‡∏≤‡∏ô",
                            "‡∏Ñ‡πà‡∏≤‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• (‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û)": "‡∏Ñ‡πà‡∏≤‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• (‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û)",
                            "‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏°/‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì": "‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏°/‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì"
                        };
                        
                        return `
                            <div class="space-y-4">
                                ${InputWrap("‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤", 
                                    createSelect('matchmaker', 'goal', f.goal, goalOptions, "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏Å")
                                )}
                                ${InputWrap("‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏ó‡∏µ‡πà‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•", 
                                    createInput('matchmaker', 'budget', f.budget, "‡πÄ‡∏ä‡πà‡∏ô 30,000", "number"),
                                    true
                                )}
                            </div>
                        `;
                    
                    case "closing":
                        return `
                            <div class="space-y-4">
                                ${InputWrap("‡∏à‡∏∏‡∏î‡∏™‡∏ô‡πÉ‡∏à‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤", 
                                    createInput('closing', 'interest_point', f.interest_point, "‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á‡πÇ‡∏£‡∏Ñ‡∏£‡πâ‡∏≤‡∏¢‡πÅ‡∏£‡∏á, ‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏∑‡∏ô")
                                )}
                                ${InputWrap("‡∏Ç‡πâ‡∏≠‡∏Å‡∏±‡∏á‡∏ß‡∏•‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠", 
                                    createTextarea('closing', 'last_concern', f.last_concern, "‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏•‡∏±‡∏ß‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡πÅ‡∏û‡∏á‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï, ‡πÑ‡∏°‡πà‡πÅ‡∏ô‡πà‡πÉ‡∏à‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏°", 3),
                                    true
                                )}
                            </div>
                        `;
                    
                    case "prompt_designer":
                        const toneOptions = {
                            "Professional": "‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£",
                            "‡∏≠‡∏ö‡∏≠‡∏∏‡πà‡∏ô/‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏±‡∏ô‡πÄ‡∏≠‡∏á": "‡∏≠‡∏ö‡∏≠‡∏∏‡πà‡∏ô/‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏±‡∏ô‡πÄ‡∏≠‡∏á",
                            "‡∏Å‡∏£‡∏∞‡∏ï‡∏∏‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à": "‡∏Å‡∏£‡∏∞‡∏ï‡∏∏‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à"
                        };
                        
                        return `
                            <div class="space-y-4">
                                ${InputWrap("‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå", 
                                    createInput('prompt_designer', 'objective', f.objective, "‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏ó‡∏™‡∏ô‡∏ó‡∏ô‡∏≤, ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÇ‡∏û‡∏™‡∏ï‡πå")
                                )}
                                ${InputWrap("‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢", 
                                    createInput('prompt_designer', 'target', f.target, "‡πÄ‡∏ä‡πà‡∏ô ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ß‡∏±‡∏¢‡∏ó‡∏≥‡∏á‡∏≤‡∏ô, ‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à")
                                )}
                                ${InputWrap("‡πÇ‡∏ó‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£", 
                                    createSelect('prompt_designer', 'tone', f.tone, toneOptions, "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏ó‡∏ô"),
                                    true
                                )}
                                ${InputWrap("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏â‡∏û‡∏≤‡∏∞", 
                                    createTextarea('prompt_designer', 'details', f.details, "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏™‡πà", 3),
                                    true
                                )}
                            </div>
                        `;
                    
                    default:
                        return `<div class="text-center text-slate-500 p-8">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</div>`;
                }
            }
            
            renderSetupPage() {
                const rhOptions = Object.keys(RH_DATA).map(rh => 
                    `<option value="${rh}" ${this.state.userProfile.rh === rh ? 'selected' : ''}>${rh}</option>`
                ).join('');
                
                const zoneOptions = this.state.userProfile.rh 
                    ? ZONES[this.state.userProfile.rh].map(z => 
                        `<option value="${z}" ${this.state.userProfile.zone === z ? 'selected' : ''}>${z}</option>`
                      ).join('')
                    : '';
                
                // Calculate mode badge
                const modeBadge = this.state.useAIMode ? 
                    `<div class="mode-badge-ai">${ICONS.aiBadge} ‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•</div>` :
                    `<div class="mode-badge-alt">${ICONS.altBadge} ‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</div>`;
                
                return `
                    <div class="fixed-height bg-gradient-to-br from-slate-900 to-slate-950 flex items-center justify-center p-4 overflow-auto">
                        <div class="bg-white rounded-3xl shadow-2xl w-full max-w-md p-6 md:p-8 overflow-hidden relative">
                            <div class="absolute top-0 right-0 p-4 opacity-5">
                                ${ICONS.sparkles.replace('icon-warning', '').replace('fa-sparkles', 'fa-star')}
                            </div>
                            
                            <div class="flex flex-col items-center mb-6 relative">
                                <div class="w-16 h-16 bg-gradient-to-br from-sky-500 to-indigo-600 rounded-2xl flex items-center justify-center text-white mb-4 shadow-xl">
                                    ${ICONS.sparkles.replace('icon-warning', 'text-white')}
                                </div>
                                <h1 class="text-2xl md:text-3xl font-black text-slate-900 tracking-tight">MAMA V.2</h1>
                                <p class="text-[10px] bg-gradient-to-r from-sky-600 to-indigo-600 bg-clip-text text-transparent font-bold tracking-[0.2em] uppercase mt-1">Sales Support System</p>
                                ${modeBadge}
                            </div>
                            
                            <div class="space-y-4">
                                ${this.state.useAIMode ? `
                                    <div>
                                        <label class="block text-[11px] font-bold text-slate-500 uppercase tracking-widest mb-2 ml-1">API KEY</label>
                                        <input type="password" 
                                            id="api-key-input"
                                            value="${this.state.apiKey}" 
                                            oninput="app.setState({ apiKey: this.value })"
                                            placeholder="‡∏£‡∏∞‡∏ö‡∏∏ API Key" 
                                            class="form-input w-full rounded-xl p-3 text-base">
                                        <p class="text-xs text-slate-500 mt-1">‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</p>
                                    </div>
                                ` : ''}
                                
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-[11px] font-bold text-slate-500 uppercase tracking-widest mb-2 ml-1">REGION (RH)</label>
                                        <select 
                                            id="rh-select"
                                            value="${this.state.userProfile.rh}" 
                                            onchange="app.handleSelectChange('userProfile', 'rh', this.value)"
                                            class="form-input w-full rounded-xl p-3 text-base">
                                            <option value="" disabled ${!this.state.userProfile.rh ? 'selected' : ''}>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å RH</option>
                                            ${rhOptions}
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-[11px] font-bold text-slate-500 uppercase tracking-widest mb-2 ml-1">ZONE</label>
                                        <select 
                                            id="zone-select"
                                            value="${this.state.userProfile.zone}" 
                                            onchange="app.handleSelectChange('userProfile', 'zone', this.value)"
                                            ${!this.state.userProfile.rh ? 'disabled' : ''}
                                            class="form-input w-full rounded-xl p-3 text-base ${!this.state.userProfile.rh ? 'bg-slate-50' : ''}">
                                            <option value="" disabled ${!this.state.userProfile.zone ? 'selected' : ''}>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏ã‡∏ô</option>
                                            ${zoneOptions}
                                        </select>
                                    </div>
                                </div>
                                
                                ${!this.state.useAIMode && !this.state.apiKey ? `
                                    <div class="p-4 bg-gradient-to-r from-slate-100 to-slate-200 rounded-xl border border-slate-300">
                                        <p class="text-sm text-slate-700 mb-3">
                                            <strong>‡πÑ‡∏°‡πà‡∏°‡∏µ API Key?</strong><br>
                                            ‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ API Key
                                        </p>
                                        <button 
                                            onclick="app.showAlternativeModePopup()"
                                            class="w-full py-3 bg-gradient-to-r from-slate-600 to-slate-700 text-white font-bold rounded-xl hover:from-slate-700 hover:to-slate-800 transition-all flex items-center justify-center gap-2">
                                            ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏ö ... ‡∏Å‡∏£‡∏ì‡∏µ‡πÑ‡∏°‡πà‡∏°‡∏µ API Key
                                        </button>
                                    </div>
                                ` : ''}
                                
                                <div class="pt-4 border-t border-slate-200">
                                    <button 
                                        onclick="if(app.state.userProfile.rh && app.state.userProfile.zone) app.setState({ isSetup: true }); else alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å RH ‡πÅ‡∏•‡∏∞‡πÇ‡∏ã‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô')"
                                        class="w-full bg-gradient-to-r from-sky-600 to-indigo-600 hover:from-sky-700 hover:to-indigo-700 text-white font-bold py-4 rounded-xl transition-all flex items-center justify-center gap-2 shadow-lg shadow-sky-900/20">
                                        ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ${ICONS.chevronRight}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            showAlternativeModePopup() {
                Modal.show(
                    "‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏î‡πâ‡∏ß‡∏¢ AI",
                    () => {
                        window.location.href = "https://pltpdttb-jpg.github.io/sales-assist/";
                    },
                    () => {
                        console.log("User cancelled alternative mode");
                    }
                );
            }
            
            renderMainPage() {
                const tabs = [
                    { id: 'needs_analysis', label: '1. ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£', icon: ICONS.calculator },
                    { id: 'ice_breaking', label: '2. ‡∏ö‡∏ó‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏à', icon: ICONS.message },
                    { id: 'objection', label: '3. ‡∏ó‡∏•‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠‡πÇ‡∏ï‡πâ‡πÅ‡∏¢‡πâ‡∏á', icon: ICONS.shield },
                    { id: 'simplifier', label: '4. ‡∏¢‡πà‡∏≠‡∏¢‡∏ú‡∏•‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå', icon: ICONS.gift },
                    { id: 'matchmaker', label: '5. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå', icon: ICONS.bag },
                    { id: 'closing', label: '6. ‡∏™‡∏£‡∏∏‡∏õ‡πÅ‡∏•‡∏∞‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢', icon: ICONS.file },
                    { id: 'prompt_designer', label: '7. Prompt Designer', icon: ICONS.terminal },
                ];
                
                const rh = RH_DATA[this.state.userProfile.rh] || {};
                const zone = this.state.userProfile.zone;
                
                // Mode indicator
                const modeIndicator = this.state.useAIMode ? 
                    `<div class="mode-badge-ai text-xs">${ICONS.aiBadge} ‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•</div>` :
                    `<div class="mode-badge-alt text-xs">${ICONS.altBadge} ‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</div>`;
                
                return `
                    <div class="fixed-height flex flex-col md:flex-row overflow-hidden">
                        <!-- Sidebar -->
                        <aside class="w-full md:w-72 bg-gradient-to-b from-slate-900 to-slate-950 text-white flex flex-col flex-shrink-0 z-30 shadow-2xl">
                            <div class="p-4 md:p-6 border-b border-white/5 flex items-center gap-3">
                                <div class="w-10 h-10 bg-gradient-to-br from-sky-500 to-indigo-600 rounded-xl flex items-center justify-center text-white">
                                    ${ICONS.sparkles.replace('icon-warning', 'text-white')}
                                </div>
                                <div>
                                    <span class="font-black text-xl block leading-none">MAMA <span class="bg-gradient-to-r from-sky-400 to-indigo-400 bg-clip-text text-transparent">V.2</span></span>
                                    <span class="text-[8px] text-slate-500 font-bold tracking-[0.2em]">PRU ACADEMY [ttb]</span>
                                </div>
                            </div>
                            
                            <div class="flex-1 overflow-y-auto p-3 md:p-4 space-y-1.5 custom-scrollbar">
                                ${tabs.map(tab => `
                                    <button
                                        onclick="app.setState({ activeTab: '${tab.id}', aiResponse: '' })"
                                        class="w-full flex items-center gap-3 px-4 py-3.5 rounded-2xl transition-all group ${this.state.activeTab === tab.id ? 'bg-gradient-to-r from-sky-600 to-indigo-600 text-white shadow-lg' : 'text-slate-400 hover:bg-white/5 hover:text-white'}">
                                        ${tab.icon}
                                        <span class="text-[13px] font-bold">${tab.label}</span>
                                    </button>
                                `).join('')}
                            </div>
                            
                            <div class="p-4 bg-black/20 border-t border-white/5">
                                <div class="bg-slate-800/50 rounded-2xl p-4 relative overflow-hidden">
                                    <div class="text-[10px] text-slate-500 font-bold mb-2 flex items-center gap-1 uppercase">
                                        ${ICONS.map} ${zone}
                                    </div>
                                    <div class="text-xs font-bold mb-1 truncate">${rh.name || '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏†‡∏π‡∏°‡∏¥‡∏†‡∏≤‡∏Ñ'}</div>
                                    <div class="text-[10px] text-slate-400 italic">"${rh.tone || '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏†‡∏π‡∏°‡∏¥‡∏†‡∏≤‡∏Ñ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î'}"</div>
                                    ${modeIndicator}
                                    <button onclick="app.setState({ isSetup: false })" class="absolute top-2 right-2 text-slate-600 hover:text-sky-400">
                                        ${ICONS.rotate}
                                    </button>
                                </div>
                            </div>
                        </aside>
                        
                        <!-- Main Content -->
                        <main class="flex-1 flex flex-col overflow-hidden relative">
                            <!-- Header -->
                            <header class="bg-white px-4 md:px-8 py-4 md:py-5 border-b flex justify-between items-center z-10">
                                <div class="flex-1">
                                    <div class="flex items-center gap-3 mb-1">
                                        <h2 class="text-lg md:text-xl font-black text-slate-800">
                                            ${this.state.activeTab.replace('_', ' ').toUpperCase()}
                                        </h2>
                                        ${this.state.useAIMode ? 
                                            '<div class="mode-badge-ai text-xs">AI</div>' : 
                                            '<div class="mode-badge-alt text-xs">ALT</div>'}
                                    </div>
                                    <div class="flex gap-2 mt-1">
                                        ${rh.keywords ? rh.keywords.slice(0, 2).map(k => `
                                            <span class="text-[9px] bg-slate-100 text-slate-500 px-2 py-0.5 rounded-full font-bold">#${k}</span>
                                        `).join('') : ''}
                                    </div>
                                </div>
                                <button 
                                    onclick="app.handleGenerate()"
                                    ${this.state.loading ? 'disabled' : ''}
                                    class="px-4 md:px-8 py-2 md:py-3 rounded-xl font-black transition-all flex items-center gap-2 shadow-xl ${this.state.loading ? 'bg-slate-100 text-slate-400 cursor-not-allowed' : 'bg-gradient-to-r from-sky-600 to-indigo-600 text-white hover:from-sky-700 hover:to-indigo-700 shadow-sky-900/10'}"
                                    style="min-width: 140px;">
                                    ${this.state.loading ? 
                                        '<i class="fas fa-spinner fa-spin"></i>' : 
                                        ICONS.sparkles.replace('icon-warning', 'text-white')}
                                    <span class="hidden md:inline">${this.state.loading ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå...' : '‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå'}</span>
                                    <span class="md:hidden">${this.state.loading ? '...' : '‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå'}</span>
                                </button>
                            </header>
                            
                            <div class="flex-1 flex overflow-hidden">
                                <!-- Left: Input Panel -->
                                <div class="w-full md:w-80 bg-white border-r overflow-y-auto p-4 md:p-6 flex-shrink-0 custom-scrollbar">
                                    <div class="mb-6 flex items-center justify-between">
                                        <h4 class="text-[11px] font-black text-slate-500 uppercase tracking-widest">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤</h4>
                                        ${ICONS.trending}
                                    </div>
                                    <div id="input-section">
                                        ${this.renderInputSection()}
                                    </div>
                                    
                                    <!-- Region Insights -->
                                    <div class="mt-8 pt-8 border-t space-y-4">
                                        <div class="flex items-center gap-2 bg-gradient-to-r from-sky-600 to-indigo-600 bg-clip-text text-transparent">
                                            ${ICONS.building}
                                            <span class="text-[11px] font-black uppercase tracking-wider">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà</span>
                                        </div>
                                        <div class="p-4 bg-slate-50 rounded-2xl border">
                                            <p class="text-sm text-slate-600 leading-relaxed italic">"${rh.dynamics || '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏†‡∏π‡∏°‡∏¥‡∏†‡∏≤‡∏Ñ'}"</p>
                                        </div>
                                        <div class="space-y-2">
                                            <div class="flex items-center gap-2 bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">
                                                ${ICONS.stethoscope}
                                                <span class="text-[11px] font-black uppercase tracking-wider">‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</span>
                                            </div>
                                            <div class="flex flex-wrap gap-1.5">
                                                ${rh.hospitals ? rh.hospitals.map(h => `
                                                    <span class="text-[10px] bg-white border px-2 py-1 rounded-lg text-slate-500 font-bold">${h}</span>
                                                `).join('') : '<span class="text-[10px] text-slate-400">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏†‡∏π‡∏°‡∏¥‡∏†‡∏≤‡∏Ñ</span>'}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Right: Output Panel -->
                                <div class="flex-1 bg-gradient-to-br from-slate-50 to-white overflow-y-auto custom-scrollbar relative">
                                    ${this.renderOutputPanel()}
                                </div>
                            </div>
                        </main>
                    </div>
                `;
            }
            
            renderOutputPanel() {
                if (!this.state.aiResponse) {
                    return `
                        <div class="h-full flex flex-col items-center justify-center opacity-20 select-none px-6 md:px-12 text-center py-12">
                            <div class="w-24 h-24 md:w-32 md:h-32 bg-gradient-to-br from-slate-200 to-slate-300 rounded-full flex items-center justify-center mb-6 shadow-inner">
                                ${ICONS.sparkles.replace('icon-warning', 'text-slate-400')}
                            </div>
                            <h3 class="text-xl md:text-3xl font-black tracking-tight bg-gradient-to-r from-slate-400 to-slate-600 bg-clip-text text-transparent">‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h3>
                            <p class="mt-2 text-slate-500 max-w-sm text-sm md:text-base">
                                ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ã‡πâ‡∏≤‡∏¢ ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå"<br>
                                <span class="text-xs text-slate-600 font-medium mt-2 inline-block">
                                    ${this.state.useAIMode ? '‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•' : '‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å'}
                                </span>
                            </p>
                            ${this.state.error ? `
                                <div class="mt-8 p-4 bg-red-50 text-red-600 border border-red-200 rounded-2xl text-xs font-bold w-full max-w-md">
                                    ${this.state.error}
                                </div>
                            ` : ''}
                        </div>
                    `;
                }
                
                // Format response text
                const formatResponse = (text) => {
                    return text
                        .replace(/\n\n/g, '<br><br>')
                        .replace(/\n/g, '<br>')
                        .replace(/\*\*(.*?)\*\*/g, '<strong class="text-slate-900">$1</strong>')
                        .replace(/\*(.*?)\*/g, '<em>$1</em>')
                        .replace(/### (.*?)(<br>|$)/g, '<h3 class="text-lg font-black text-slate-900 mt-6 mb-3 flex items-center gap-2 border-l-4 border-sky-500 pl-4">$1</h3>')
                        .replace(/- (.*?)(<br>|$)/g, '<li class="ml-4 mb-2 flex items-start"><span class="text-sky-500 mr-2">‚Ä¢</span> $1</li>')
                        .replace(/[0-9]+\. (.*?)(<br>|$)/g, '<li class="ml-4 mb-2 flex items-start"><span class="text-slate-700 font-bold mr-2">$&</span></li>')
                        .replace(/\+\+ (.*?)(<br>|$)/g, '<li class="ml-4 mb-2 flex items-start"><span class="text-emerald-500 mr-2">+</span> $1</li>')
                        .replace(/‚úÖ (.*?)(<br>|$)/g, '<li class="ml-4 mb-2 flex items-start"><span class="text-emerald-500 mr-2">‚úì</span> $1</li>');
                };
                
                return `
                    <div class="max-w-3xl mx-auto p-4 md:p-8 lg:p-12 pb-20 md:pb-32 slide-in-from-bottom">
                        <!-- Mode Indicator -->
                        <div class="mb-6 flex justify-center">
                            ${this.state.useAIMode ? 
                                '<div class="mode-badge-ai text-sm">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏à‡∏≤‡∏Å‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•</div>' :
                                '<div class="mode-badge-alt text-sm">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏à‡∏≤‡∏Å‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</div>'}
                        </div>
                        
                        <!-- Result Wrapper -->
                        <div class="bg-white rounded-2xl md:rounded-[2rem] shadow-2xl shadow-slate-200 overflow-hidden border border-white">
                            <!-- Result Header -->
                            <div class="bg-gradient-to-r from-sky-600 to-indigo-600 px-6 md:px-10 py-4 md:py-6 text-white flex justify-between items-center">
                                <div class="flex items-center gap-3">
                                    <div class="w-8 h-8 md:w-10 md:h-10 bg-white/20 rounded-xl flex items-center justify-center backdrop-blur-sm">
                                        ${ICONS.lightbulb.replace('icon-warning', 'text-white')}
                                    </div>
                                    <div>
                                        <div class="text-[10px] font-bold text-sky-300 uppercase tracking-[0.2em]">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</div>
                                        <div class="text-sm font-bold opacity-90">${this.state.activeTab.replace('_', ' ').toUpperCase()}</div>
                                    </div>
                                </div>
                                <button onclick="navigator.clipboard.writeText('${this.state.aiResponse.replace(/'/g, "\\'")}'); alert('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏á‡∏Ñ‡∏•‡∏¥‡∏õ‡∏ö‡∏≠‡∏£‡πå‡∏î‡πÅ‡∏•‡πâ‡∏ß');" class="w-8 h-8 md:w-10 md:h-10 bg-white/10 hover:bg-white/20 rounded-xl flex items-center justify-center transition-colors backdrop-blur-sm">
                                    ${ICONS.copy.replace('icon-gray', 'text-white')}
                                </button>
                            </div>
                            
                            <!-- Result Content -->
                            <div class="p-6 md:p-10 text-slate-700 leading-relaxed text-sm md:text-base overflow-wrap-break">
                                ${formatResponse(this.state.aiResponse)}
                            </div>
                            
                            <!-- Rating -->
                            <div class="bg-slate-50 p-4 md:p-6 border-t flex justify-center items-center gap-4 md:gap-6">
                                <span class="text-[11px] font-black text-slate-500 uppercase tracking-widest">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡πÑ‡∏´‡∏°?</span>
                                <div class="flex gap-4">
                                    <button onclick="app.setState({ feedback: 'up' })" class="w-10 h-10 md:w-12 md:h-12 rounded-full flex items-center justify-center border transition-all ${this.state.feedback === 'up' ? 'bg-gradient-to-br from-emerald-500 to-green-500 text-white border-emerald-500' : 'bg-white text-slate-300 hover:text-emerald-500'}">
                                        ${ICONS.thumbsUp}
                                    </button>
                                    <button onclick="app.setState({ feedback: 'down' })" class="w-10 h-10 md:w-12 md:h-12 rounded-full flex items-center justify-center border transition-all ${this.state.feedback === 'down' ? 'bg-gradient-to-br from-rose-500 to-pink-500 text-white border-rose-500' : 'bg-white text-slate-300 hover:text-rose-500'}">
                                        ${ICONS.thumbsDown}
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Footer Buttons -->
                        <div class="mt-6 md:mt-8 flex flex-wrap justify-center gap-3">
                            <button class="bg-white border text-slate-600 px-4 md:px-6 py-2 md:py-3 rounded-xl text-xs font-bold hover:bg-slate-50 flex items-center gap-2 shadow-sm">
                                ${ICONS.share} <span class="hidden md:inline">‡πÅ‡∏ä‡∏£‡πå</span>
                            </button>
                            <button class="bg-white border text-slate-600 px-4 md:px-6 py-2 md:py-3 rounded-xl text-xs font-bold hover:bg-slate-50 flex items-center gap-2 shadow-sm">
                                ${ICONS.save} <span class="hidden md:inline">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</span>
                            </button>
                        </div>
                    </div>
                `;
            }
            
            render() {
                const root = document.getElementById('root');
                if (!root) {
                    console.error("Root element not found!");
                    return;
                }
                
                try {
                    const html = this.state.isSetup ? this.renderMainPage() : this.renderSetupPage();
                    root.innerHTML = html;
                    
                    // Restore input values
                    this.restoreInputValues();
                    
                } catch (error) {
                    console.error("Render error:", error);
                    root.innerHTML = `
                        <div class="fixed-height flex items-center justify-center bg-red-50">
                            <div class="bg-white p-8 rounded-2xl shadow-lg max-w-md">
                                <h1 class="text-2xl font-bold text-red-600 mb-4">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</h1>
                                <p class="text-slate-600 mb-4">‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö</p>
                                <button onclick="location.reload()" class="w-full bg-sky-600 text-white py-3 rounded-lg font-bold">
                                    ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
                                </button>
                            </div>
                        </div>
                    `;
                }
            }
            
            restoreInputValues() {
                this.inputElements = {};
                
                for (const tab in this.state.forms) {
                    for (const field in this.state.forms[tab]) {
                        const id = `${tab}-${field}`;
                        const element = document.getElementById(id);
                        if (element) {
                            element.value = this.state.forms[tab][field];
                            this.inputElements[id] = element;
                        }
                    }
                }
            }
            
            init() {
                // Load state from localStorage
                try {
                    const savedState = localStorage.getItem('mama_v2_state');
                    if (savedState) {
                        const parsed = JSON.parse(savedState);
                        // Keep existing forms data when loading
                        const currentForms = this.state.forms;
                        this.setState({ 
                            ...parsed,
                            forms: { ...currentForms, ...parsed.forms },
                            loading: false,
                            aiResponse: "",
                            error: ""
                        });
                    }
                } catch (e) {
                    console.log("No saved state found or error loading:", e);
                }
                
                // Save state to localStorage on changes
                const originalSetState = this.setState.bind(this);
                this.setState = (newState) => {
                    originalSetState(newState);
                    try {
                        // Don't save sensitive data
                        const stateToSave = {
                            userProfile: this.state.userProfile,
                            activeTab: this.state.activeTab,
                            forms: this.state.forms,
                            useAIMode: this.state.useAIMode,
                            // Don't save apiKey or aiResponse
                        };
                        localStorage.setItem('mama_v2_state', JSON.stringify(stateToSave));
                    } catch (e) {
                        console.log("Could not save state to localStorage");
                    }
                };
                
                this.render();
            }
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            window.app = new MAMAV2();
            console.log("MAMA V.2 Sales Support System loaded");
        });
    </script>
</body>
</html>
